<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>登录页面</title>

    <script type="text/javascript" th:src="@{/js/jquery-3.2.1.min.js}"></script>
    <script>

        $(function () {
            $("#btn").click(function () {
                $("#errormsg").html("");
                // 获得手机号
                var pvar = $("#phone").val();
                var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
                if (!myreg.test(pvar)) {
                    $("#errormsg").html("不是正确的手机号");
                    $("#errormsg").css("color", "red");
                } else {

                    alert("发送成功");

                    //发送请求控制层，获得验证码

                    $.ajax({
                            type: "get",
                            url: "/learntruth/getYanMa",
                            data: "phone=" + pvar,
                            success: function (result) {
                                if (result.respCode == "00000") {

                                    //手机成功接受验证码短信
                                    $("#yanzhengma").val(request.yan);
                                } else {
                                    // 手机接受短信错误
                                    $("#errormsg").html(request.respDesc);
                                    $("#errormsg").css("color", "red");

                                }
                            },
                            error: function () {
                            }
                        }
                    );
                }
            });


            //登录
            $("#form1").submit(
                function () {

                    var yan = $("#yanzhengma").val();//验证码
                    var phone = $("#phonema").val();//填写的验证码
                    if (yan == phone) {
                        return true;
                    }

                }
            );


        });
    </script>

</head>
<body>
<form id="form1" th:action="@{/login}">
    <p>用户名：<input type="text" name="uname"/></p>
    <p>密码：<input type="password" name="pwd"/></p>
    <p>手机号码：<input type="number" name="phone" id="phone"/>

        <input type="button" value="获取验证码" id="btn"/> <span id="errormsg"></span></p>
    <p>验证码：<input type="number" name="phone" id="phonema"/></p>
    <p><input type="hidden" name="yanzhengma" id="yanzhengma"/></p>


    <input type="submit" value="登录"/> <input type="reset" value="取消"/>

</form>


</body>
</html>
